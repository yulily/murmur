---
title: "astro でサイト作ってみた"
description: "作ってみたログ"
pubDate: "Mar 23 2023"
heroImage: "/murmur/start.jpg"
---

前に middleman で作った[ブログ](http://yulily.github.io/)が、ビルド後の静的ファイルしか残ってなさそうだったので新しく作り直しました
一番簡単に作れそうだったので、astro にしました

### astro とは
astro は Webサイトを構築するための Webフレームワークです
コンポーネント単位で機能やページのパーツを作る事ができます  
コンポーネントは .astro で作成しますが、Vue や React も使う事ができるようです  
また JavaScript では TypeScript を使う事が可能です  
ビルドすると、静的ファイルに変換されます  
src ディレクトリ内のものが dist ディレクトリを見ると変換されているのが分かります  
単純な html となるため高速に表示する事が可能となります

### 作ってみる
早速作ってみます
以下のコマンドを打つと
```
npm create astro@latest
```
以下のように対話形式でインストールすることができます
```
Need to install the following packages:
  create-astro@3.1.3
Ok to proceed? (y) y

╭─────╮  Houston:
│ ◠ ◡ ◠  Keeping the internet weird since 2021.
╰─────╯

 astro   v2.3.0 Launch sequence initiated.
```

プロジェクトの配置場所を決めます
```
   dir   Where should we create your new project?
         ./myblog
```
ブログ作りたいので、ブログテンプレートを選択しました
```
  tmpl   How would you like to start your new project?
         Use blog template
      ✔  Template copied
```
あとは依存関係は推奨のインストールで、TypeScript は使用して型は一番厳密なやつにしました  
最後のは git でバージョン管理したいので yes で
```
  deps   Install dependencies?
         Yes
      ✔  Dependencies installed

    ts   Do you plan to write TypeScript?
         Yes

   use   How strict should TypeScript be?
         Strict
      ✔  TypeScript customized

   git   Initialize a new git repository?
         Yes
      ✔  Git initialized
```
対話が終わると構築は完了です

サーバー起動は以下のコマンドを行うとでき、表示された url にアクセスするとブログがもう出来上がってます
```
cd myblog
npm run dev
```

今回作った意図としては、ブログを作り直すことと外部 api 利用するためにプライバシーポリシーのページが必要だったため、プライバシーポリシーの追加もやってみます

### ページ追加してみる
src/pages の下に置いたものが各ページとして扱われます
ファイルベースルーティングと呼ぶそうです
.astro だけでなく .md も置けるとのことです

### .md 単体で読み込ませる
プライバシーポリシーは殆どテキストで、ブログみたいに気軽に書けるようにしたいので .md で管理できるようにします

.md を src/pages に置いたら表示はできたのですが、
他と同じように .astro でページ管理しコンテンツを .md で管理するような構成合わせてみたいと思います

ブログの構成を参考にして以下のような感じにしました

#### src/content/privacy_policy.md
ここにプライバシーポリシーの内容を書きます

#### src/layouts/PrivacyPolicy.astro
ここは Astro.props 経由で md ファイルから取れた値を、html にどう組み込むか書きます
レイアウトの定義です、レイアウトコンポーネントと呼ばれます
\<slot /> にコンテンツ部分が入るみたいです
```
---
〜 省略 〜

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---
〜 省略 〜

<h1 class="title">{title}</h1>

〜 省略 〜

<slot />

〜 省略 〜

```
src/pages に直接 .md 置く場合は、以下のように.md に layout 指定して置くだけで表示できます
```
layout: ../layouts/PrivacyPolicy.astro
```

#### src/pages/privacy_policy.astro
ここはルーティングされる各ページのエントリポイントになります  
.md とレイアウトコンポーネントを読み込んでいます
```
---
import * as PrivacyPolicy from '../content/privacy_policy.md';
import PrivacyPolicyLayout from '../layouts/PrivacyPolicy.astro';

const { title, description, pubDate, updatedDate, heroImage } = PrivacyPolicy.frontmatter;
const formattedPubDate = new Date(pubDate);
const formattedUpdatedDate = new Date(updatedDate);

---

<PrivacyPolicyLayout title={title} description={description} pubDate={formattedPubDate} updatedDate={formattedUpdatedDate} heroImage={heroImage}>
	<PrivacyPolicy.default />
</PrivacyPolicyLayout>
```
PrivacyPolicy で .md を読み込みます  
PrivacyPolicy.frontmatter には .md の先頭に書かれたメタデータが格納されています  
pubDate, updatedDate を dateオブジェクトにしているのは、FormattedDateコンポーネントの機能を使うためです  
ブログではここで dateオブジェクトにしてそうでした
```
const blog = defineCollection({
	// Type-check frontmatter using a schema
	schema: z.object({
		title: z.string(),
		description: z.string(),
		// Transform string to Date object
		pubDate: z
			.string()
			.or(z.date())
			.transform((val) => new Date(val)),
		updatedDate: z
			.string()
			.optional()
			.transform((str) => (str ? new Date(str) : undefined)),
		heroImage: z.string().optional(),
	}),
});
```
blog は複数形なため collection で取得しており、config.ts で blog のスキーマを定義しているようです
```
await getCollection('blog')
```
話は戻ります  
PrivacyPolicyLayout でレイアウトコンポーネントを読み込んでおり、
\<PrivacyPolicyLayout> で使えるようになっています
```
const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
```
上記のレイアウトコンポーネントで定義したパラメータを以下のようにコンポーネントに渡しています
```
<PrivacyPolicyLayout title={title} description={description} pubDate={formattedPubDate} updatedDate={formattedUpdatedDate} heroImage={heroImage}>
```

3つのファイルを作成することで、コンテンツ→レイアウト→ページとそれぞれ役割を果たしページが描画できるようになります

次回は github pages を使って push したらデプロイする仕組みを見ていこうと思います
